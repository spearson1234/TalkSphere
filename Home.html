<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #2e2b55;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .banner {
            background-color: #6a0dad;
            color: white;
            padding: 25px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            position: relative;
        }

        .banner h1 {
            margin: 0;
            font-size: 28px;
        }

        .event-timer {
            font-size: 14px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            left: 45%;
            transform: translateX(-50%);
            white-space: nowrap;
            color: gold;
        }

        .user-email {
            position: relative;
            cursor: pointer;
        }

        .user-email span {
            font-size: 18px;
            display: block;
        }

        .user-coins {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }

        .user-coins span {
            margin-left: 5px;
            font-size: 22px;
            font-weight: bold;
        }

        .yellow-dot {
            width: 10px;
            height: 10px;
            background-color: yellow;
            border-radius: 50%;
            display: inline-block;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: #6a0dad;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 4px;
            z-index: 1000;
            min-width: 200px;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            flex-direction: column;
        }

        .dropdown-menu.show {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .dropdown-menu a {
            display: block;
            padding: 12px 16px;
            color: white;
            text-decoration: none;
            font-size: 16px;
            margin: 5px 0;
            border-radius: 4px;
            background-color: #8a2be2;
            font-weight: bold;
        }

        .dropdown-menu a:hover {
            background-color: #5d3fd3;
        }

        .dropdown-menu p {
            margin: 5px 0;
            padding: 0;
            font-size: 18px;
            background-color: transparent;
            border: none;
            cursor: default;
        }

        .coins-spent {
            color: red;
            margin-top: auto;
        }

        .chat-frame {
            padding: 10px;
            background-color: #34234a;
            flex-grow: 1;
            overflow-y: auto;
        }

        .chat-message {
            margin: 10px 0;
            padding: 10px;
            background-color: #8a2be2;
            color: white;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
            animation: glitch 1.5s infinite;
            user-select: none; /* Prevent text selection */
        }

        .chat-message:hover {
            background-color: #6a0dad;
            cursor: pointer;
        }

        .mod-tag,
        .chatterplus-tag {
            font-style: italic;
            color: rgba(255, 255, 255, 0.5);
            margin-left: 5px;
        }

        @keyframes glitch {
            0% {
                transform: translate(0);
                opacity: 1;
            }

            20% {
                transform: translate(-2px, 2px);
                opacity: 0.8;
            }

            40% {
                transform: translate(2px, -2px);
                opacity: 1;
            }

            60% {
                transform: translate(-1px, 1px);
                opacity: 0.9;
            }

            80% {
                transform: translate(1px, -1px);
                opacity: 1;
            }

            100% {
                transform: translate(0);
                opacity: 1;
            }
        }

        .typing-indicator {
            margin: 10px;
            font-style: italic;
            color: rgba(255, 255, 255, 0.5);
            display: none;
        }

        .reaction-menu {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: space-around;
            background-color: #6a0dad;
            border-radius: 5px;
            padding: 5px;
            visibility: hidden;
        }

        .reaction-menu span {
            cursor: pointer;
            font-size: 20px;
        }

        .reaction-menu span:hover {
            transform: scale(1.3);
        }

        .input-container {
            position: relative;
            padding: 10px;
            background-color: #6a0dad;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .input-container input[type="text"] {
            width: 60%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .input-container button {
            padding: 10px 40px;
            margin-left: 10px;
            border: none;
            background-color: #8a2be2;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
        }

        .input-container button:hover {
            background-color: #5d3fd3;
        }

        .basket-icon {
            width: 24px;
            height: 24px;
            margin-left: 10px;
            cursor: pointer;
        }

        .arrow {
            position: absolute;
            top: -30px;
            left: 10px;
            cursor: pointer;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 10px solid white;
        }

        .expanded-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #6a0dad;
            color: white;
            display: none;
            justify-content: space-around;
            align-items: center;
            padding: 20px;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .expanded-banner.show {
            display: flex;
        }

        .expanded-banner a {
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            font-size: 14px;
        }

        .expanded-banner a:hover {
            color: white;
        }

        .expanded-banner #home-link {
            font-weight: bold;
            color: white;
        }

        .shop-frame {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background-color: #34234a;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
            padding: 20px;
            transition: right 0.3s ease;
            z-index: 1002;
            display: none;
            flex-direction: column;
            align-items: center;
            color: white;
        }

        .shop-frame.show {
            display: flex;
            right: 0;
        }

        .shop-frame h2 {
            margin-top: 0;
            font-size: 24px;
            color: #8a2be2;
        }

        .shop-frame .item-card {
            background-color: #4b2c64;
            padding: 15px;
            margin: 10px 0;
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            color: white;
        }

        .shop-frame .item-card h3 {
            margin: 0;
            font-size: 20px;
        }

        .shop-frame .item-card p {
            margin: 5px 0 10px;
            font-size: 16px;
        }

        .original-price {
            text-decoration: line-through;
            color: #ff0000;
        }

        .discounted-price {
            color: gold;
            font-weight: bold;
        }

        .shop-frame .item-card button {
            padding: 8px 16px;
            width: 100%;
            border: none;
            background-color: #8a2be2;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        .shop-frame .item-card button:hover {
            background-color: #5d3fd3;
        }

        .loading-circle {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8a2be2;
            border-radius: 50%;
            width: 15px;
            height: 15px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .payment-frame {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            padding: 20px;
            background-color: #34234a;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            color: white;
            text-align: center;
            display: none;
            z-index: 1003;
        }

        .payment-frame h2 {
            margin: 0 0 15px;
        }

        .payment-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }

        .payment-buttons button {
            padding: 8px 16px;
            background-color: #8a2be2;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            width: 45%;
        }

        .payment-buttons button:hover {
            background-color: #5d3fd3;
        }

        .settings-sidebar {
            position: fixed;
            left: -250px;
            top: 0;
            width: 250px;
            height: 100%;
            background-color: #34234a;
            z-index: 1004;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
            transition: left 0.3s ease;
            display: none;
            color: white;
            flex-direction: column;
            align-items: center;
        }

        .settings-sidebar.show {
            display: flex;
            left: 0;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
            margin-left: 10px;
        }

        .switch input {
            display: none;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 28px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #8a2be2;
        }

        input:checked+.slider:before {
            transform: translateX(22px);
        }

        .toggle-container {
            width: 100%;
            text-align: left;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .toggle-container .switch {
            margin-left: 20px;
            vertical-align: middle;
        }

        .toggle-container hr {
            border: 1px solid #6a0dad;
            margin-top: 10px;
        }

        .rent-page {
            position: fixed;
            left: 100%;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: #2e2b55;
            z-index: 1004;
            display: flex;
            flex-direction: column;
            transform: translateX(0);
            transition: transform 0.5s ease;
            color: rgba(255, 255, 255, 0.5);
            justify-content: center;
            align-items: center;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
        }

        .rent-page.show {
            transform: translateX(-100%);
        }

        .rent-banner {
            background-color: #6a0dad;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }

        .announcement {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            z-index: 1005;
            width: 300px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .announcement h2 {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .announcement p {
            font-size: 16px;
            margin-bottom: 20px;
        }

        .announcement button {
            padding: 10px 20px;
            background-color: #8a2be2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .announcement button:hover {
            background-color: #5d3fd3;
        }

        .secret-message {
            display: none;
            margin-top: 20px;
            font-size: 16px;
            animation: fadeIn 1s ease-in-out;
        }

        .close-btn {
            margin-top: 20px;
            cursor: pointer;
            color: #ff4d4d;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .slide-back {
            font-size: 24px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            align-self: flex-start;
            margin-bottom: 20px;
        }

        .slide-back:hover {
            color: #8a2be2;
        }
    </style>
</head>

<body>
    <div class="banner">
        <h1>Chatter</h1>
        <div class="event-timer" id="event-timer">Event Starting in: 0D 0H 0M 0S</div>
        <div class="user-email">
            <span id="user-email">Email@gmail.com</span>
            <div class="user-coins">
                <div class="yellow-dot"></div>
                <span id="coins-display">Coins: 0</span>
            </div>
            <div class="dropdown-menu" id="dropdown-menu">
                <a href="#" id="settings-link">Settings</a>
                <a href="#" id="rent-link" class="disabled">Rent (Coming Soon)</a>
                <a href="#">Change Username</a>
                <a href="#" id="logout-button">Log Out</a>
                <p class="coins-spent">Coins Spent: 0</p>
            </div>
        </div>
    </div>

    <div class="chat-frame" id="chat-frame">
        <!-- Chat messages will appear here -->
        <div class="chat-message" id="message-1">
            Ceo: Hello Chatter Community,
            I would lke to Introduce u to This app called Chatter. Chatter is a app where u can discorver new Features
            and make friends. it also will have some Secuirty Features in settings soon. We do not tollirate..
            .online Bullying
            .Rude and Disrespectful
            .Spamming
            .Scams
            .Fake Identity
            .And more!
            please do follow these rules Carfully Bc we will Disable ur account and u will not able to get it back until u email us.

            Thank You for using Chatter,

            Sincerly, CEO


            <span class="mod-tag">(official CEO)</span>
            <div class="reaction-menu" id="reaction-menu-1">
                <span>üëç</span>
                <span>‚ù§Ô∏è</span>
                <span>üòÇ</span>
                <span>üòÆ</span>
                <span>üò¢</span>
            </div>
        </div>
        <div class="typing-indicator" id="typing-indicator">User is typing...</div>
    </div>

    <div class="input-container">
        <div class="arrow" id="expand-arrow"></div>
        <input type="text" placeholder="Type a message..." id="message-input">
        <button id="send-button">Send</button>
        <img src="https://img.icons8.com/ios-filled/50/ffffff/shopping-basket-2.png" class="basket-icon" id="basket-icon"
            alt="Basket">
    </div>

    <div class="expanded-banner" id="expanded-banner">
        <a href="#" id="home-link">Home</a>
        <a href="#" class="disabled">Search (Coming Soon)</a>
        <a href="#" class="disabled">Credits (Coming Soon)</a>
    </div>

    <div class="shop-frame" id="shop-frame">
        <span class="slide-back" id="slide-back-shop">&lt;</span>
        <h2>Shop</h2>
        <div class="item-card">
            <h3>Mod</h3>
            <p>5.2M Coins</p>
            <button id="buy-mod-button">Buy</button>
        </div>
        <div class="item-card">
            <h3>Chatter+</h3>
            <p>
                <span class="original-price">70 Coins</span>
                <span class="discounted-price">35 Coins (50% Off)</span>
            </p>
            <button id="buy-chatterplus-button">Buy</button>
        </div>
    </div>

    <div class="payment-frame" id="payment-frame">
        <h2 id="payment-message">Are you sure you want to buy Mod for 5.2M Coins?</h2>
        <p>Total: <span id="total-coins">5.2M Coins</span></p>
        <div class="payment-buttons">
            <button id="yes-button">Yes</button>
            <button id="no-button">No</button>
        </div>
    </div>

    <div class="settings-sidebar" id="settings-sidebar">
        <span class="slide-back" id="slide-back-settings">&gt;</span>
        <h2>Settings</h2>
        <div class="toggle-container">
            <label for="shake-toggle">Shake Animation</label>
            <label class="switch">
                <input type="checkbox" id="shake-toggle" checked>
                <span class="slider"></span>
            </label>
            <hr>
        </div>
    </div>

    <div class="rent-page" id="rent-page">
        Rent (Coming Soon)
    </div>

    <div class="announcement" id="announcement">
        <h2>For Daniel!</h2>
        <p>To my hubby, Happy 2 month Anniversary, I love you so much and you're my world, my universe, and my life. You are amazing, cute, handsome, mine; you are everything and mean everything to me. Words can't describe how much I love you, and you have no idea how excited or happy I get when I get a notification from you. I used to be really depressed, and now my mental health is getting better because of you. I love you more than everything, and I really don't deserve you. I'm happy I'm with you, you're the best, and I hope you like this. xxxx</p>
        <button class="close-btn" id="close-announcement">Close</button>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <!-- Firebase Initialization -->
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyAHSW4ettEHj3Y562zYSI_n0Z1OwFaGsgw",
            authDomain: "login-71866.firebaseapp.com",
            databaseURL: "https://login-71866-default-rtdb.firebaseio.com",
            projectId: "login-71866",
            storageBucket: "login-71866.appspot.com",
            messagingSenderId: "434042354282",
            appId: "1:434042354282:web:fbc98eaefe2ef6513a2813"
        };
        firebase.initializeApp(firebaseConfig);

        document.addEventListener("DOMContentLoaded", function () {
            const emailElement = document.getElementById('user-email');
            const coinsDisplay = document.getElementById('coins-display');
            const coinsSpentDisplay = document.querySelector('.coins-spent');
            const dropdownMenu = document.getElementById('dropdown-menu');
            const settingsLink = document.getElementById('settings-link');
            const rentLink = document.getElementById('rent-link');
            const logoutButton = document.getElementById('logout-button');
            const eventTimerElement = document.getElementById('event-timer');
            const announcement = document.getElementById('announcement');
            const closeAnnouncementButton = document.getElementById('close-announcement');
            const expandArrow = document.getElementById('expand-arrow');
            const expandedBanner = document.getElementById('expanded-banner');
            const homeLink = document.getElementById('home-link');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
            const chatFrame = document.getElementById('chat-frame');
            const basketIcon = document.getElementById('basket-icon');
            const shopFrame = document.getElementById('shop-frame');
            const buyModButton = document.getElementById('buy-mod-button');
            const buyChatterPlusButton = document.getElementById('buy-chatterplus-button');
            const paymentFrame = document.getElementById('payment-frame');
            const paymentMessage = document.getElementById('payment-message');
            const totalCoins = document.getElementById('total-coins');
            const yesButton = document.getElementById('yes-button');
            const noButton = document.getElementById('no-button');
            const settingsSidebar = document.getElementById('settings-sidebar');
            const rentPage = document.getElementById('rent-page');
            const shakeToggle = document.getElementById('shake-toggle');
            const slideBackShop = document.getElementById('slide-back-shop');
            const slideBackSettings = document.getElementById('slide-back-settings');
            const typingIndicator = document.getElementById('typing-indicator');

            let coins = 0;
            let coinsSpent = 0;
            let isAdmin = false;
            let ownsMod = false;
            let ownsChatterPlus = false;
            let shakeAnimationEnabled = true;
            let typingTimeout;

            // Typing indicator logic
            messageInput.addEventListener('input', function () {
                typingIndicator.style.display = 'block';
                clearTimeout(typingTimeout);

                typingTimeout = setTimeout(function () {
                    typingIndicator.style.display = 'none';
                }, 2000);
            });

            // Message reaction logic
            document.querySelectorAll('.chat-message').forEach(message => {
                message.addEventListener('click', function (event) {
                    const reactionMenu = message.querySelector('.reaction-menu');
                    reactionMenu.style.visibility = reactionMenu.style.visibility === 'visible' ? 'hidden' : 'visible';

                    reactionMenu.addEventListener('click', function (event) {
                        const selectedEmoji = event.target.textContent;
                        message.textContent += ` ${selectedEmoji}`;
                        reactionMenu.style.visibility = 'hidden';
                    });
                });
            });

            // Slide back the shop frame
            slideBackShop.addEventListener('click', function () {
                shopFrame.classList.remove('show');
            });

            // Slide back the settings sidebar
            slideBackSettings.addEventListener('click', function () {
                settingsSidebar.classList.remove('show');
            });

            // Update the Coins Spent display
            function updateCoinsSpentDisplay() {
                coinsSpentDisplay.textContent = `Coins Spent: ${coinsSpent}`;
            }

            // Load chat messages from Firebase
            function loadMessages() {
                const messagesRef = firebase.database().ref("messages");
                messagesRef.on("child_added", function (snapshot) {
                    const messageData = snapshot.val();
                    displayMessage(messageData.username, messageData.message, messageData.isMod, messageData.isChatterPlus);
                });
            }

            // Display a message in the chat frame
            function displayMessage(username, message, isMod, isChatterPlus) {
                const chatMessage = document.createElement('div');
                chatMessage.className = 'chat-message';
                chatMessage.textContent = `${username}: ${message}`;

                if (isMod) {
                    const modTag = document.createElement('span');
                    modTag.className = 'mod-tag';
                    modTag.textContent = '(Mod)';
                    chatMessage.appendChild(modTag);
                }

                if (isChatterPlus) {
                    const chatterPlusTag = document.createElement('span');
                    chatterPlusTag.className = 'chatterplus-tag';
                    chatterPlusTag.textContent = '(Chatter+)';
                    chatMessage.appendChild(chatterPlusTag);
                }

                if (!shakeAnimationEnabled) {
                    chatMessage.style.animation = 'none';
                }

                chatFrame.appendChild(chatMessage);
                chatFrame.scrollTop = chatFrame.scrollHeight; // Auto-scroll to the bottom
            }

            emailElement.addEventListener('click', function () {
                dropdownMenu.classList.toggle('show');
            });

            window.addEventListener('click', function (event) {
                if (!emailElement.contains(event.target)) {
                    dropdownMenu.classList.remove('show');
                }
            });

            logoutButton.addEventListener('click', function () {
                firebase.auth().signOut().then(function () {
                    window.location.href = "login.html"; // Redirect to login page
                }).catch(function (error) {
                    console.error('Sign Out Error', error);
                });
            });

            expandArrow.addEventListener('click', function () {
                expandedBanner.classList.toggle('show');
            });

            basketIcon.addEventListener('click', function () {
                shopFrame.classList.add('show');
            });

            settingsLink.addEventListener('click', function () {
                settingsSidebar.classList.add('show');
            });

            rentLink.addEventListener('click', function () {
                rentPage.classList.add('show');
            });

            homeLink.addEventListener('click', function () {
                expandedBanner.classList.remove('show'); // Close the banner when Home is clicked
            });

            // Check if the user owns the Mod or Chatter+ items
            function checkOwnership() {
                const user = firebase.auth().currentUser;
                if (user) {
                    firebase.database().ref(`users/${user.uid}`).once('value').then(function (snapshot) {
                        ownsMod = snapshot.val().ownsMod === true;
                        ownsChatterPlus = snapshot.val().ownsChatterPlus === true;
                        updateBuyButtons();
                    });

                    // Load Coins Spent and Coins Pending
                    firebase.database().ref(`users/${user.uid}`).once('value').then(function (snapshot) {
                        coinsSpent = snapshot.val().coinsSpent || 0;
                        updateCoinsSpentDisplay();
                    });
                }
            }

            function updateBuyButtons() {
                if (ownsMod) {
                    buyModButton.textContent = "Owned";
                    buyModButton.disabled = true;
                }
                if (ownsChatterPlus) {
                    buyChatterPlusButton.textContent = "Owned";
                    buyChatterPlusButton.disabled = true;
                }
            }

            // Buy Mod functionality
            buyModButton.addEventListener('click', function () {
                buyModButton.innerHTML = 'Processing... <div class="loading-circle"></div>'; // Show loading animation

                setTimeout(function () {
                    paymentMessage.textContent = "Are you sure you want to buy Mod for 5.2M Coins?";
                    totalCoins.textContent = "5.2M Coins";
                    paymentFrame.style.display = 'block';
                }, 2000); // Simulate a 2-second delay for checking balance
            });

            // Buy Chatter+ functionality
            buyChatterPlusButton.addEventListener('click', function () {
                buyChatterPlusButton.innerHTML = 'Processing... <div class="loading-circle"></div>'; // Show loading animation

                setTimeout(function () {
                    paymentMessage.textContent = "Are you sure you want to buy Chatter+ for 35 Coins?";
                    totalCoins.textContent = "35 Coins";
                    paymentFrame.style.display = 'block';
                }, 2000); // Simulate a 2-second delay for checking balance
            });

            yesButton.addEventListener('click', function () {
                const isModPurchase = paymentMessage.textContent.includes('Mod');
                const cost = isModPurchase ? 5200000 : 35;

                if (coins >= cost || isAdmin) {
                    coins -= cost;
                    coinsSpent += cost;
                    coinsDisplay.textContent = `Coins: ${coins}`;
                    paymentFrame.style.display = 'none';
                    updateCoinsSpentDisplay();

                    const user = firebase.auth().currentUser;
                    if (user) {
                        if (isModPurchase) {
                            firebase.database().ref(`users/${user.uid}`).update({
                                ownsMod: true,
                                coinsSpent: coinsSpent
                            });
                            ownsMod = true;
                        } else {
                            firebase.database().ref(`users/${user.uid}`).update({
                                ownsChatterPlus: true,
                                coinsSpent: coinsSpent
                            });
                            ownsChatterPlus = true;
                        }
                        updateBuyButtons();
                    }
                } else {
                    alert("Not enough coins!");
                    paymentFrame.style.display = 'none';
                }
            });

            noButton.addEventListener('click', function () {
                paymentFrame.style.display = 'none';
                if (paymentMessage.textContent.includes('Mod')) {
                    buyModButton.innerHTML = 'Buy'; // Reset the button
                } else {
                    buyChatterPlusButton.innerHTML = 'Buy'; // Reset the button
                }
            });

            // Send button functionality
            sendButton.addEventListener('click', function () {
                const message = messageInput.value;
                if (message.trim() !== "") {
                    const user = firebase.auth().currentUser;
                    if (user) {
                        const username = isAdmin ? "Admin" : (user.displayName || user.email.split('@')[0]);
                        // Save message to Firebase
                        firebase.database().ref("messages").push({
                            username: username,
                            message: message,
                            isMod: ownsMod,
                            isChatterPlus: ownsChatterPlus
                        });
                        messageInput.value = ""; // Clear the input after sending
                    }
                }
            });

            // Toggle shake animation
            shakeToggle.addEventListener('change', function () {
                shakeAnimationEnabled = shakeToggle.checked;
                const chatMessages = document.querySelectorAll('.chat-message');
                chatMessages.forEach(function (chatMessage) {
                    chatMessage.style.animation = shakeAnimationEnabled ? '' : 'none';
                });
            });

            // Increment coins by 10 every minute for non-admin users
            if (!isAdmin) {
                setInterval(function () {
                    coins += 10;
                    coinsDisplay.textContent = `Coins: ${coins}`;
                }, 60000);
            }

            // Countdown Timer Logic
            const eventStartDate = new Date("August 16, 2024 00:00:00").getTime();

            function updateTimer() {
                const now = new Date().getTime();
                const distance = eventStartDate - now;

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                eventTimerElement.textContent = `Event Starting in: ${days}D ${hours}H ${minutes}M ${seconds}S`;

                if (distance < 0) {
                    clearInterval(timerInterval);
                    announcement.style.display = 'block'; // Show the announcement
                    eventTimerElement.textContent = "Event Started!";
                }
            }

            const timerInterval = setInterval(updateTimer, 1000);

            closeAnnouncementButton.addEventListener('click', function () {
                announcement.style.display = 'none';
            });

            // Firebase authentication logic
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    const email = user.email;
                    emailElement.textContent = email; // Update the displayed email
                    isAdmin = (email === "admin@gmail.com");
                    coinsDisplay.textContent = isAdmin ? `Coins: 98T` : `Coins: ${coins}`;
                    // Load existing messages
                    loadMessages();
                    // Check ownership status
                    checkOwnership();
                }
            });
        });
    </script>
</body>

</html>
